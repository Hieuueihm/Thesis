module median (
    input clk,
    input rst_n,
    input [7:0] red_i,
    input [7:0] green_i,
    input [7:0] blue_i,

    input i_valid,

    output [7:0] red_o,
    output [7:0] green_o,
    output [7:0] blue_o,

    output 
);
  wire [7:0] RGB2Gray_grayscale_o;
  wire RGB2Gray_;
  wire [7:0] d0_o, d1_o, d2_o, d3_o, d4_o, d5_o, d6_o, d7_o, d8_o;

  wire prepare_;
  wire [7:0] grayscale_med_o;
  wire  grayscale_med_done;

  RGB2Gray RGB2Gray_instance (
      .clk(clk),
      .rst_n(rst_n),
      .red_i(red_i),
      .green_i(green_i),
      .blue_i(blue_i),
      .i_valid(i_valid),
      .grayscale_o(RGB2Gray_grayscale_o),
      .(RGB2Gray_)
  );
  median_preparation #(
      .DEPTH(360)
  ) median_PREAPARATION (
      .clk(clk),
      .rst_n(rst_n),
      .i_valid(RGB2Gray_),
      .grayscale_i(RGB2Gray_grayscale_o),
      .data0_o(d0_o),
      .data1_o(d1_o),
      .data2_o(d2_o),
      .data3_o(d3_o),
      .data4_o(d4_o),
      .data5_o(d5_o),
      .data6_o(d6_o),
      .data7_o(d7_o),
      .data8_o(d8_o),
      .(prepare_)
  );


median_filter_3x3 median_FILTER_3X3(
    .clk(clk),
     .rst_n(rst_n),
     .i_valid(prepare_),
     .d0_i(d0_o),  
     .d1_i(d1_o),  
     .d2_i(d2_o),  
     .d3_i(d3_o),
     .d4_i(d4_o),
     .d5_i(d5_o),
     .d6_i(d6_o),
     .d7_i(d7_o),
     .d8_i(d8_o),

    .median_o(grayscale_med_o),
    .(grayscale_med_done)
);
 Gray2RGB Gray2RGB (
      .clk(clk),
      .rst_n(rst_n),
      .i_valid(grayscale_med_done),
      .grayscale_i(grayscale_med_o),
      .red_o(red_o),
      .green_o(green_o),
      .blue_o(blue_o),
      .()
  );



endmodule
